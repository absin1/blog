---
title: Apache as a Load Balancer
date: 2019-06-24 20:48:01
tags:
---
Let's first install apache server
```
sudo apt-get install apache2
```
First thing we are going to do is enable SSL
```
sudo a2enmod ssl
```
Let's take a default configuration generated by apache2 and modify it, to create out own virtual host.
```
cp /etc/apache2/sites-available/default-ssl.conf /etc/apache2/sites-available/ind.talentify.in.conf
```
Time to make SSL chained and validated
```
vi /etc/apache2/sites-available/ind.talentify.in.conf
```
Find these keys and put these values
```
	SSLCertificateFile      /root/vv/talentify.crt
	SSLCertificateKeyFile  /root/vv/my_store.key
	SSLCertificateChainFile /root/vv/Root-R1.crt
```
Now we are done configuring the basic SSL. Let's enable this virtual host.
```
sudo a2ensite ind.talentify.in
```
Restart and then check the DNS with SSL
```
systemctl reload apache2
```
https://ind.talentify.in should be working now
## Reverse Proxy 
(Official Doc link)[https://httpd.apache.org/docs/2.4/howto/reverse_proxy.html]
(Also good)[https://www.digitalocean.com/community/tutorials/how-to-use-apache-as-a-reverse-proxy-with-mod_proxy-on-ubuntu-16-04]
Let's first enable all the modules required for Load Balancing and Reverse Proxying
```
sudo a2enmod proxy
sudo a2enmod proxy_http
sudo a2enmod proxy_balancer
sudo a2enmod lbmethod_byrequests
sudo a2enmod lbmethod_bytraffic
```
Let;s add requisite configuration, you should have these servers up and running
```
vi /etc/apache2/sites-available/ind.talentify.in.conf
```
We define a proxy with balancer and then tell apache to use the same. We also want the second one to take most of the load, so we give a load factor of 3.
```
	<Proxy balancer://backend>
            BalancerMember http://db.talentify.in
            BalancerMember http://ind.talentify.in:8080 loadfactor=3 timeout=1
            ProxySet lbmethod=byrequests
        </Proxy>
        ProxyPass "/"  "balancer://backend/"
        ProxyPassReverse "/"  "balancer://backend/"
```

Voila!!!

